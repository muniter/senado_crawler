// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Cuatrenio {
  id           Int           @id @default(autoincrement())
  inicio       Int
  fin          Int
  title        String
  legislaturas Legislatura[]

  @@unique([inicio, fin])
  @@unique([title])
  @@index([title])
  @@index([inicio, fin])
}

model Legislatura {
  id          Int              @id @default(autoincrement())
  inicio      Int
  fin         Int
  title       String
  cuatrenio   Cuatrenio        @relation(fields: [cuatrenioId], references: [id])
  cuatrenioId Int
  proyectos   ProyectoSenado[]

  @@unique([inicio, fin])
  @@unique([title])
  @@index([inicio, fin])
  @@index([title])
}

model ProyectoSenado {
  id              Int                     @id @default(autoincrement())
  numero          String
  titulo          String
  comision        Comision                @relation(fields: [comisionId], references: [id])
  comisionId      Int
  estado          String?
  estadoAnotacion String?
  fechaRadicado   DateTime
  legislatura     Legislatura             @relation(fields: [legislaturaId], references: [id])
  legislaturaId   Int
  url             String
  detalles        ProyectoSenadoDetalles?
  relacionados    ProyectosRelacionados[] @relation("Relacionados")
  autores         AutorProyectos[]
  ponentes        PonenteDebate[]

  @@unique([numero])
  @@index([numero])
  @@index([comisionId])
  @@index([estado])
}

model ProyectoSenadoDetalles {
  id                      Int             @id @default(autoincrement())
  proyectoId              Int
  proyecto                ProyectoSenado  @relation(fields: [proyectoId], references: [id])
  origen                  String?
  tipoLey                 String?
  // TODO: Cambiar a tipo de dato Date
  fechaEnvioComision      String?
  ponentes                PonenteDebate[]
  aprobacionPrimerDebate  DateTime?
  aprobacionSegundoDebate DateTime?
  conciliacion            DateTime?

  @@unique([proyectoId])
}

model ProyectosRelacionados {
  id                Int            @id @default(autoincrement())
  proyectoId        Int
  proyecto          ProyectoSenado @relation(name: "Relacionados", fields: [proyectoId], references: [id])
  relacionadoNumero String

  @@unique([proyectoId, relacionadoNumero])
}

model Comision {
  id        Int              @id @default(autoincrement())
  nombre    String
  proyectos ProyectoSenado[]

  @@unique([nombre])
  @@index([nombre])
}

model Autor {
  id            Int              @id @default(autoincrement())
  nombre        String
  proyectos     AutorProyectos[]
  PonenteDebate PonenteDebate[]

  @@unique([nombre])
}

model AutorProyectos {
  id         Int            @id @default(autoincrement())
  autorId    Int
  autor      Autor          @relation(fields: [autorId], references: [id])
  proyectoId Int
  proyecto   ProyectoSenado @relation(fields: [proyectoId], references: [id])

  @@unique([autorId, proyectoId])
}

model PonenteDebate {
  id                       Int                     @id @default(autoincrement())
  autorId                  Int
  autor                    Autor                   @relation(fields: [autorId], references: [id])
  proyectoId               Int
  proyecto                 ProyectoSenado          @relation(fields: [proyectoId], references: [id])
  debate                   Int
  ProyectoSenadoDetalles   ProyectoSenadoDetalles? @relation(fields: [proyectoSenadoDetallesId], references: [id])
  proyectoSenadoDetallesId Int?

  @@unique([autorId, proyectoId, debate])
}
